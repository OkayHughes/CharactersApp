<script>
$(document).ready(function(){
    if (<%= edit ? "true" : "false" %>){
        $("#new-tag-location").replaceWith($("#new-tag-content").html());
    } else {
        $("#new-tag-location").html('');
    }
});
</script>

<% tag_structure = JSON.load(File.read(Rails.root.join("public", "tagdata.json"))) %>

<ul class="tags">
<% if character.tags.count != 0 %>

    <% character.tags.each do |t| %>
        <li name="tag_<%= t.id %>" class="inline-tags"><%= t.key + ": " + t.value %>
        <% if edit %>
            <div class="edit-button inline-tags">
                <%= link_to(edit_tag_path(t), remote: true) do %>
                <span class="edit-link inline-tags">Edit</span>
            </div>
            <% end %>
        <% end %>
        </li>
    <% end %>
<% else %>

    <li>This character has no tags yet.</li>

<% end %>
    <div id="new-tag-location"> </div>
</ul>

<ul class="tag-editors">
<% tag_structure.keys.each do |tag| %>
    <li>
    <%= tag %>
    <%= character.tags.select{|k| k.key == tag} %>
    <%= form_for(tag, remote: true) do |t| %>
        <%= t.select(:key, tag_structure[tag].keys.map{ |x| [x, x] }) %>
        <%= t.submit %>
    <% end %>
    </li>
<% end %>
</ul>

<div id="new-tag-content">
    <li class="new">
    <%= form_for(tag, remote: true) do |t| %>
        <%= t.text_field(:key, placeholder: "Category") %>
        <%= t.text_field(:value, placeholder: "Value") %>
        <%= t.number_field(:depth, step: 1, value: 0) %>
        <%= t.hidden_field(:character_id, value: character.id) %>
        <%= t.submit %>
    <% end %>
    </li>
</div>